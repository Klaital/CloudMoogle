<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Parser
  
    &mdash; Documentation by YARD 0.8.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (P)</a> &raquo;
    
    
    <span class="title">Parser</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Parser
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Parser</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/Parser.rb</dd>
  
</dl>
<div class="clear"></div>





  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#actions-instance_method" title="#actions (instance method)">- (Object) <strong>actions</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute actions.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_sleep-instance_method" title="#max_sleep (instance method)">- (Object) <strong>max_sleep</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute max_sleep.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_mode-instance_method" title="#output_mode (instance method)">- (Object) <strong>output_mode</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>one of: [s, mysql_insert, json].</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pause_duration-instance_method" title="#pause_duration (instance method)">- (Object) <strong>pause_duration</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute pause_duration.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute stop.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#action_to_json-class_method" title="action_to_json (class method)">+ (Object) <strong>action_to_json</strong>(act) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#action_to_mysql_insert-class_method" title="action_to_mysql_insert (class method)">+ (Object) <strong>action_to_mysql_insert</strong>(act, actions_tbl = &quot;actions&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#action_to_s-class_method" title="action_to_s (class method)">+ (Object) <strong>action_to_s</strong>(act) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_line-class_method" title="parse_line (class method)">+ (Object) <strong>parse_line</strong>(s, old_act, output_mode = 's') </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Parser) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Parser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_action-instance_method" title="#save_action (instance method)">- (Object) <strong>save_action</strong>(action, outstream = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong>(instream, outstream = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If outstream is set to nil, then the actions will just be saved to the
@actions array for the caller to access directly.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Parser (class)">Parser</a></span></tt>) <strong>initialize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Parser</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 13</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='ivar'>@stop</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@pause_duration</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='ivar'>@max_sleep</span> <span class='op'>=</span> <span class='int'>1200</span>
    <span class='ivar'>@output_mode</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>s</span><span class='tstring_end'>'</span></span>
    <span class='ivar'>@actions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="actions-instance_method">
  
    - (<tt>Object</tt>) <strong>actions</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute actions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_actions'>actions</span>
  <span class='ivar'>@actions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="max_sleep=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="max_sleep-instance_method">
  
    - (<tt>Object</tt>) <strong>max_sleep</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute max_sleep</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_sleep'>max_sleep</span>
  <span class='ivar'>@max_sleep</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="output_mode=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="output_mode-instance_method">
  
    - (<tt>Object</tt>) <strong>output_mode</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>one of: [s, mysql_insert, json]</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_mode'>output_mode</span>
  <span class='ivar'>@output_mode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="pause_duration=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="pause_duration-instance_method">
  
    - (<tt>Object</tt>) <strong>pause_duration</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute pause_duration</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pause_duration'>pause_duration</span>
  <span class='ivar'>@pause_duration</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="stop=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute stop</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


7
8
9</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 7</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='ivar'>@stop</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="action_to_json-class_method">
  
    + (<tt>Object</tt>) <strong>action_to_json</strong>(act) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 35</span>

<span class='kw'>def</span> <span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_action_to_json'>action_to_json</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_act'>act</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="action_to_mysql_insert-class_method">
  
    + (<tt>Object</tt>) <strong>action_to_mysql_insert</strong>(act, actions_tbl = &quot;actions&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 38</span>

<span class='kw'>def</span> <span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_action_to_mysql_insert'>action_to_mysql_insert</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='comma'>,</span> <span class='id identifier rubyid_actions_tbl'>actions_tbl</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>actions</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_actions_tbl'>actions_tbl</span><span class='rbrace'>}</span><span class='tstring_content'> VALUES (NULL, '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>format</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>timestamp</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s_mysql'>to_s_mysql</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', </span><span class='tstring_end'>&quot;</span></span>
    
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
    <span class='kw'>case</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>format</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>COMBAT</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NULL, '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>actor</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>action</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'> </span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ability name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>damage</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LIGHT</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>color</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', NULL, NULL, NULL, NULL, NULL, NULL</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>KILL</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NULL, '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>actor</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>', NULL, NULL, NULL, NULL</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_s'>s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="action_to_s-class_method">
  
    + (<tt>Object</tt>) <strong>action_to_s</strong>(act) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 20</span>

<span class='kw'>def</span> <span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_action_to_s'>action_to_s</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
    
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>format</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>timestamp</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>case</span><span class='lparen'>(</span><span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>format</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> 
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>COMBAT</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>action</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>actor</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>damage</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ability name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LIGHT</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>color</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>KILL</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_s'>s</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>actor</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_act'>act</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
        
    <span class='kw'>return</span> <span class='id identifier rubyid_s'>s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_line-class_method">
  
    + (<tt>Object</tt>) <strong>parse_line</strong>(s, old_act, output_mode = 's') 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 56</span>

<span class='kw'>def</span> <span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_parse_line'>parse_line</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_old_act'>old_act</span><span class='comma'>,</span> <span class='id identifier rubyid_output_mode'>output_mode</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>s</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>
    <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='id identifier rubyid_old_act'>old_act</span>
    <span class='comment'># extract the timestamp, if any
</span>    <span class='id identifier rubyid_parse_time'>parse_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
    <span class='id identifier rubyid_parse_time'>parse_time</span> <span class='op'>=</span> <span class='const'>Timestamp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='comma'>,</span> <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_hour'>hour</span><span class='comma'>,</span> <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_sec'>sec</span><span class='rparen'>)</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\[\d\d:\d\d:\d\d\]</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_hour'>hour</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_minute'>minute</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>..</span><span class='int'>5</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_parse_time'>parse_time</span><span class='period'>.</span><span class='id identifier rubyid_second'>second</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>7</span><span class='op'>..</span><span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    
    <span class='comment'># strip out &quot;Magic Burst!&quot; if present
</span>    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^Magic Burst!</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>13</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
        
    <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_old_action'>old_action</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pattern_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_old_action'>old_action</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pattern_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>  <span class='comment'># half-completed action
</span>        <span class='comment'># look for the second line
</span>        <span class='comment'># run the associated parser
</span>        <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_old_action'>old_action</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pattern_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_2_parse</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_old_action'>old_action</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>timestamp</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_time'>parse_time</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_to_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output_mode'>output_mode</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='kw'>return</span> <span class='lbracket'>[</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_to_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output_mode'>output_mode</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_old_action'>old_action</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='comment'># if we read this point, then a 2-line action appeared to start on the previous line, but was not completed on this line.
</span>    <span class='comment'># thus, we abandon the old data by setting old_action=nil
</span>    <span class='comment'># then we move on to see if a new action seems to have started
</span>    <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='kw'>nil</span>
    
    <span class='comment'># look for the first line of an action
</span>    <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='period'>.</span><span class='id identifier rubyid_each_index'>each_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='comment'># just skip it if there's no parsing method defined
</span>        <span class='kw'>next</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_methods'>methods</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_parse</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        
        <span class='comment'># fetch the pattern to match against
</span>        <span class='id identifier rubyid_patn'>patn</span> <span class='op'>=</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>weaponskill_1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> 
            <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_weaponskills'>weaponskills</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        
        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='id identifier rubyid_patn'>patn</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_parse</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_old_action'>old_action</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>timestamp</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_time'>parse_time</span>
            <span class='kw'>if</span><span class='lparen'>(</span><span class='const'>Patterns</span><span class='period'>.</span><span class='id identifier rubyid_first_line_patterns'>first_line_patterns</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_1$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
                <span class='kw'>return</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='rbracket'>]</span>
            <span class='kw'>else</span>
                <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_to_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output_mode'>output_mode</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
                    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_to_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output_mode'>output_mode</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span>
                <span class='kw'>else</span>
                    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_old_action'>old_action</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span> <span class='comment'>#end first_line_patterns.each_index
</span>    
    <span class='comment'># if we get here, then none of the patterns matched
</span>    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="save_action-instance_method">
  
    - (<tt>Object</tt>) <strong>save_action</strong>(action, outstream = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_action'>save_action</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_outstream'>outstream</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='comment'># Save the action to our internal array, and if an outstream is specified, write to it!
</span>    <span class='ivar'>@actions</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_outstream'>outstream</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_outstream'>outstream</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>IO</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_outstream'>outstream</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong>(instream, outstream = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If outstream is set to nil, then the actions will just be saved to the
@actions array for the caller to access directly.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/Parser.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_instream'>instream</span><span class='comma'>,</span> <span class='id identifier rubyid_outstream'>outstream</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
    <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_sleep_time'>sleep_time</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>while</span><span class='lparen'>(</span><span class='op'>!</span><span class='ivar'>@stop</span><span class='rparen'>)</span>
        <span class='comment'># may need to wait for more lines to be written into the input stream. Sleep for a bit at a time in between as needed.
</span>        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_instream'>instream</span><span class='period'>.</span><span class='id identifier rubyid_eof'>eof</span><span class='rparen'>)</span>
            <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_sleep_time'>sleep_time</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_sleep_time'>sleep_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> 
            <span class='kw'>elsif</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@max_sleep</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_sleep_time'>sleep_time</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'># Slept too long! Quitting...</span><span class='tstring_end'>&quot;</span></span>
                <span class='ivar'>@stop</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='ivar'>@pause_duration</span><span class='rparen'>)</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        <span class='comment'># if we make it here, that means there was data to read
</span>        <span class='id identifier rubyid_sleep_time'>sleep_time</span> <span class='op'>=</span> <span class='kw'>nil</span>
        
        <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_instream'>instream</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
        <span class='kw'>next</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>10</span><span class='rparen'>)</span>
        
        <span class='comment'># if the line starts with &quot;//&quot; or &quot;#&quot;, it's a comment. Pass these through (some may be commands intended for the Analyzer)
</span>        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(\/\/|#)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
            <span class='id identifier rubyid_outstream'>outstream</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_line'>line</span>
        <span class='kw'>end</span>
 
        <span class='comment'># actually parse the line!
</span>        <span class='id identifier rubyid_output_string'>output_string</span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span> <span class='op'>=</span> <span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_parse_line'>parse_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_old_action'>old_action</span><span class='comma'>,</span> <span class='ivar'>@output_mode</span><span class='rparen'>)</span>
        
        <span class='comment'># if valid output data was returned, send it along to the output stream
</span>        <span class='kw'>if</span><span class='lparen'>(</span><span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_output_string'>output_string</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_output_string'>output_string</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_save_action'>save_action</span><span class='lparen'>(</span><span class='id identifier rubyid_output_string'>output_string</span><span class='comma'>,</span> <span class='id identifier rubyid_outstream'>outstream</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        
    <span class='kw'>end</span> <span class='comment'># end while(!@stop)        
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun Nov 10 22:09:55 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>